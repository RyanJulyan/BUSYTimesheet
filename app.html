<ul id="monthList">
</ul>
<script>
var app = {
	data:{
		version:"0.0.1",
		curDate:new Date(),
		username:"",
		monthNames: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
		records:{},
		tags:{}
	},
	editProperty:function(property, value){
		/*
		// Not working in time, Getting Duplicated Data
		if(typeof this.data[property] != "undefined"){
			this.data[property+"_old"] = this.data[property];
		}
		*/
		this.data[property] = value;
	},
	editSubProperty:function(property,subproperty, value){
		/*
		// Not working in time, Getting Duplicated Data
		if(typeof this.data[property][subproperty] != "undefined"){
			this.data[property][subproperty+"_old"] = this.data[property][subproperty];
		}
		*/
		this.data[property][subproperty] = value;
	},
	deleteProperty:function(property){
		delete this.data[property]
	},
	deleteSubProperty:function(property,subproperty){
		delete this.data[property][subproperty]
	},
	_ID:function(el){
		return document.getElementById(el);
	},
	_IDval:function(el, val){
		return document.getElementById(el).value = val;
	},
	_IDhtml:function(el, val){
		return document.getElementById(el).innerHTML = val;
	},
	setLocalStorage: function(key, val){
		localStorage.setItem(key, JSON.stringify(val));
	},
	getLocalStorage: function(key){
		localStorageVal = localStorage.getItem(key);
		try {
			if(JSON.parse(localStorageVal) != null){
				if(key == 'data'){
					return this.data = JSON.parse(localStorageVal);
				}
				else{
					return this.data[key] = JSON.parse(localStorageVal);
				}
			}
		}
		catch(err) {
			if(JSON.parse(localStorageVal) != null){
				return this.data[key] = localStorageVal;
			}
		}
	},
	displayMonth:function(){
		var list = "";
		for(monthNo in this.data.monthNames){
			list = list + "<li onclick='app.data.selectedMonth = this.innerHTML'>" + this.data.monthNames[monthNo] + "</li>";
		}
		this._IDhtml("monthList",list);
	},
	ajaxRequest: function(address_url){
		var ajax = new XMLHttpRequest();
		ajax.upload.addEventListener("progress", this.fileProgressHandler, false);
		ajax.addEventListener("load", this.fileCompleteHandler, false);
		ajax.addEventListener("error", this.fileErrorHandler, false);
		ajax.addEventListener("abort", this.fileAbortHandler, false);
		ajax.open("GET",address_url);
		ajax.send();
	},
	fileUpload:function(file, url){
		this.editProperty("file", {type:file.name});
		this.editProperty("file", {type:file.type});
		this.editProperty("file", {size:file.size});
		var formdata = new FormData();
		formdata.append("file1", file);
		var ajax = new XMLHttpRequest();
		ajax.upload.addEventListener("progress", this.fileProgressHandler, false);
		ajax.addEventListener("load", this.fileCompleteHandler, false);
		ajax.addEventListener("error", this.fileErrorHandler, false);
		ajax.addEventListener("abort", this.fileAbortHandler, false);
		ajax.open("POST", url);
		ajax.send(formdata);
	},
	fileProgressHandler:function(event){
		this.editProperty("file", {status:event.target.responseText});
		this.editProperty("file", {totalUploadSize:event.total});
		this.editProperty("file", {totalUploaded:event.loaded});
		this.editProperty("totalUploadedMessage", "Uploaded "+event.loaded+" bytes of "+event.total);
		this.editProperty("percentUploaded", Math.round((event.loaded / event.total) * 100));
		this.editProperty("percentUploadedMessage", Math.round((event.loaded / event.total) * 100)+"% uploaded... please wait");
	},
	fileCompleteHandler:function(event){
		console.log(this);
		this.editProperty("file", {status:event.target.responseText});
	},
	fileErrorHandler:function(event){
		this.editProperty("file", {status:"Upload Failed"});
	},
	fileAbortHandler:function(event){
		this.editProperty("file", {status:"Upload Aborted"});
	},
	getLocation:function() {
		if (navigator.geolocation) {
			navigator.geolocation.getCurrentPosition(this.showPosition, this.showError);
		} else {
			return "Geolocation is not supported by this browser.";
		}
	},
	showPosition:function(position) {
		var latlon = position.coords.latitude + "," + position.coords.longitude;
		
		var address_url = "https://maps.googleapis.com/maps/api/geocode/json?latlng="+latlon+"&key=AIzaSyAdrM7sgTdLeqAzTB6_RmFnLB4IRkfKreY";
		
		this.ajaxRequest(address_url);
	},
	showError:function(error) {
		switch(error.code) {
			case error.PERMISSION_DENIED:
				x.innerHTML = "User denied the request for Geolocation."
				break;
			case error.POSITION_UNAVAILABLE:
				x.innerHTML = "Location information is unavailable."
				break;
			case error.TIMEOUT:
				x.innerHTML = "The request to get user location timed out."
				break;
			case error.UNKNOWN_ERROR:
				x.innerHTML = "An unknown error occurred."
				break;
		}
	},
	addTag:function(parent, tag){
		console.log(this.data.tags);
		for(obj in this.data.tags){
			console.log(obj);
		}
		if(parent == "uncategorised" || parent == ""){
			if(tag in this.data.tags){
				return "That TAG Already Exists";
			}
			else{
				this.editSubProperty("tags", tag, []);
				this.setLocalStorage("data", this.data);
				return tag + " added to " + parent;
			}
		}
		else if(typeof this.data.tags[parent] === "undefined"){
			tags = [];
			tags.push(tag);
			this.editSubProperty("tags", parent, tags);
			this.setLocalStorage("data", this.data);
			return tag + " added to " + parent;
		}
		else {
			tags = this.data.tags[parent];
			if(tags.indexOf(tag) == -1){
				tags.push(tag);
				this.editSubProperty("tags", parent, tags);
				this.setLocalStorage("data", this.data);
				return tag + " added to " + parent;
			}
			else{
				return "That TAG Already Exists";
			}
		}
	},
	displayTags:function(){
		for(obj in this.data.tags){
			console.log(obj);
			for(newObj in this.data.tags[obj]){
				console.log(this.data.tags[obj][newObj])
			}
		}
	},
	addRecord: function(project, record){
		this.data.curDate = new Date();
		this.data.lastTransactionID = this.data.curDate.getTime();
		if(typeof record == 'undefined' || record == ""){
			record = {};
		}
		if(typeof record.year == 'undefined'){
			record["year"] = this.data.curDate.getFullYear();
		}
		if(typeof record.month == 'undefined'){
			record["month"] = this.data.curDate.getMonth();
		}
		if(typeof record.day == 'undefined'){
			record["day"] = this.data.curDate.getDate();
		}
		if(typeof record.hours == 'undefined'){
			record["hours"] = this.data.curDate.getHours();
		}
		if(typeof record.minutes == 'undefined'){
			record["minutes"] = this.data.curDate.getMinutes();
		}
		if(typeof record.username == 'undefined' || record.username == "" || record.username == null){
			var guest = prompt("Please enter your username", "");
			if (guest != null) {
				record["username"] = guest + "_" + this.data.lastTransactionID;
			}
			else{
				record["username"] = "Guest_" + this.data.lastTransactionID;
			}
		}
		else{
			record["username"] = record["username"] + "_" + this.data.lastTransactionID;
		}
		
		var d = new Date(record.year, record.month, record.day, record.hours, record.minutes);
		record["dateString"] = d;
		if(project == "work" || project == ""){
			console.log(record.username);
			if(record.username in this.data.records){
				return "That record Already Exists";
			}
			else{
				project = "uncategorised";
				var obj = {};
				if(typeof this.data.records[project] != 'undefined'){
					obj = this.data.records[project];
				}
				obj[record.username] = record;
				this.editSubProperty("records", project, obj);
				this.setLocalStorage("data", this.data);
				this.addTag("companies", project);
				return record.username + " added to " + project;
			}
		}
		else if(typeof this.data.records[project] === "undefined"){
			var obj = {};
			obj[record.username] = record;
			this.editSubProperty("records", project, obj);
			this.setLocalStorage("data", this.data);
			this.addTag("companies", project);
			return record.username + " added to " + project;
		}
		else {
			var obj = {};
			obj = this.data.records[project];
			obj[record.username] = record;
			this.editSubProperty("records", project, obj);
			this.setLocalStorage("data", this.data);
			this.addTag("companies", project);
			return record.username + " added to " + project;
		}
	}
}

var inputTypeConfig = {
	pwd:{
		type: "password",
		placeholder: "Password"
	},
	txt:{
		type: "text",
		placeholder: ""
	},
	email:{
		type: "email",
		placeholder: "Email"
	},
	tel:{
		type: "tel",
		placeholder: ""
	},
	date:{
		type: "date",
		placeholder: ""	
	},
	datetime:{
		type: "datetime-local",
		placeholder: ""	
	},
	col:{
		type:"color",
		placeholder:"Colour"
	},
	range:{
		type:"range",
		placeholder:""
	}
}

function roughSizeOfObject( value, level ) {
    if(level == undefined) level = 0;
    var bytes = 0;

    if ( typeof value === 'boolean' ) {
        bytes = 4;
    }
    else if ( typeof value === 'string' ) {
        bytes = value.length * 2;
    }
    else if ( typeof value === 'number' ) {
        bytes = 8;
    }
    else if ( typeof value === 'object' ) {
        if(value['__visited__']) return 0;
        value['__visited__'] = 1;
        for( i in value ) {
            bytes += i.length * 2;
            bytes+= 8; // an assumed existence overhead
            bytes+= roughSizeOfObject( value[i], 1 )
        }
    }

    if(level == 0){
        clear__visited__(value);
    }
    return bytes;
}

function clear__visited__(value){
    if(typeof value == 'object'){
        delete value['__visited__'];
        for(var i in value){
            clear__visited__(value[i]);
        }
    }
}

function apper(data){
	console.log(data);
}

function test(callback){
		callback("What");
}

var monthNames = ["January", "February", "March", "April", "May", "June",
  "July", "August", "September", "October", "November", "December"
];

var d = new Date();
document.write("The current month is " + monthNames[d.getMonth()]);
</script>